{% extends "biblioteca/base.html" %}

{% block content %}
  <!-- CSS do Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
  
    .select2-container--default .select2-selection--single {
      height: 38px;
      border: 1px solid #ced4da;
      border-radius: 0.375rem;
      padding: 6px 12px;
      
    }
    .select2-container--default .select2-selection--single .select2-selection__rendered {
      line-height: 24px;
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 36px;
    }
    body{
      background-color: #cccccc33;
    }

    .borrow-form {
    background-color: white;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    max-width: 500px;
    margin: 20px auto;
    }

   .borrow-form h2 {
    margin-bottom: 25px;
    color: #26264e;
    font-size: 1.5em;
    text-align: center;
    }

   .borrow-form .form-row {
    display: flex;
    flex-direction: column;
    width: 500px;
    
   }
   .borrow-form .btn {
    width: 100%;
    background-color: #2c3e50;
    color: white;
    padding: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
   }

   .borrow-form .btn:hover {
    background-color: #1f2a38;
   } 

 </style>

  <!-- JS do Select2 e jQuery (necessário para funcionar) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <h1>Empréstimos</h1>

  <section class="borrow-form book-form">
    <h2>Registrar novo empréstimo</h2>
    {% if livros %}
      <form method="post">
        {% csrf_token %}
        <div class="form-row">
          <label for="livro">Livro</label>
          <select name="livro" id="livro" class="form-select livro-select">
            {% for livro in livros %}
              <option value="{{ livro.id }}">{{ livro.titulo }} — {{ livro.autor }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-row">
          <label for="nome_usuario">Nome do usuário</label>
          <input id="nome_usuario" name="nome_usuario" class="form-control" required>
        </div>
        <button class="btn" type="submit">Registrar Empréstimo</button>
      </form>
      <script>
        $(document).ready(function() {
            $('.livro-select').select2({
                placeholder: "Selecione um livro...",
                allowClear: true
            });
        });
      </script>
    {% else %}
      <p>Não há livros disponíveis para empréstimo.</p>
    {% endif %}
  </section>

  <section style="margin-top:18px;">
    <h2>Empréstimos recentes</h2>
    {% if emprestimos %}
      <ul>
        {% for e in emprestimos %}
          
          <li>
            {{ e.nome_usuario }} — {{ e.livro.titulo }} ({{ e.data_emprestimo }})
            {% if not e.data_devolucao %}
              <form method="post" action="{% url 'devolver' e.id %}" style="display:inline; margin-left:10px;">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary btn-sm">
                    Devolver
                </button>
              </form>
            {% else %}
              <span style="margin-left:10px;color:green;">(Devolvido em {{ e.data_devolucao }})</span>
            {% endif %}
          </li>
        
        {% endfor %}
      </ul>
    {% else %}
      <p>Ainda não há empréstimos registrados.</p>
    {% endif %}
  </section>

  
{% endblock %}
